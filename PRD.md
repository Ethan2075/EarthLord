# 地球新主 产品需求文档 (PRD)

**文档版本**: v1.0
**创建日期**: 2025-12-23
**产品名称**: 地球新主 (EarthLord)
**平台**: iOS

---

## 1. 产品概述

### 1.1 产品定位
地球新主是一款基于 GPS 定位的末日生存类手机游戏，玩家通过真实世界的步行来圈地、探索、搜集资源，并在虚拟世界中建立自己的领地和家园。

### 1.2 产品愿景
打造一款融合现实世界与虚拟游戏的 LBS 生存游戏，鼓励玩家走出户外，用双脚丈量世界，在游戏中重建文明。

### 1.3 目标用户
- **主要用户**: 18-35岁，喜欢户外运动、生存类游戏的年轻用户
- **次要用户**: 对 AR/LBS 游戏感兴趣的休闲玩家
- **地域范围**: 全球 175 个国家和地区

### 1.4 核心价值主张
- **Walk to Earn**: 走路即可获得游戏资源
- **真实世界互动**: 真实地点 (POI) 与游戏资源绑定
- **社交协作**: 基于位置的玩家交易与通讯系统

---

## 2. 产品目标与成功指标

### 2.1 业务目标
| 目标类型 | 具体指标 |
|---------|---------|
| 用户获取 | 上线首月 DAU 达到 10,000 |
| 用户留存 | 7日留存率 > 40% |
| 付费转化 | 付费率 > 5% |
| 收入目标 | 月流水达到 $50,000 |

### 2.2 用户体验目标
- 新用户 5 分钟内完成首次圈地
- 核心玩法循环清晰易懂
- 支持离线使用基础功能

---

## 3. 功能需求

### 3.1 功能模块总览

| 模块编号 | 功能模块 | 优先级 | 状态 |
|---------|---------|--------|------|
| M01 | 用户登录注册系统 | P0 | 规划中 |
| M02 | GPS 圈地系统 | P0 | 规划中 |
| M03 | 领地管理系统 | P0 | 规划中 |
| M04 | POI 发现与搜刮系统 | P0 | 规划中 |
| M05 | 背包/资源管理系统 | P0 | 规划中 |
| M06 | 建造系统 | P1 | 规划中 |
| M07 | 建筑状态管理 | P1 | 规划中 |
| M08 | 玩家交易系统 | P1 | 规划中 |
| M09 | 消息中心 | P1 | 规划中 |
| M10 | 公共频道聊天 | P2 | 规划中 |
| M11 | 频道管理系统 | P2 | 规划中 |
| M12 | PTT 语音呼叫 | P2 | 规划中 |
| M13 | 通讯设备等级 | P2 | 规划中 |
| M14 | 个人主页/档案 | P1 | 规划中 |
| M15 | 多语言支持 | P1 | 规划中 |
| M16 | 付费订阅系统 | P1 | 规划中 |
| M17 | 排行榜系统 | P2 | 规划中 |
| M18 | 成就系统 | P2 | 规划中 |
| M19 | 生存体征系统 | P1 | 规划中 |

---

### 3.2 详细功能需求

#### M01: 用户登录注册系统

**功能描述**: 支持多种方式的用户身份认证

**用户故事**:
- 作为新用户，我希望能快速注册账号，以便开始游戏
- 作为老用户，我希望能用第三方账号一键登录，节省时间

**功能要求**:
| 需求ID | 需求描述 | 优先级 |
|--------|---------|--------|
| M01-01 | 邮箱注册/登录（用户名+密码） | P0 |
| M01-02 | Apple ID 登录 (Sign in with Apple) | P0 |
| M01-03 | Google 账号登录 | P0 |
| M01-04 | 邮箱验证功能 | P1 |
| M01-05 | 密码重置功能 | P1 |
| M01-06 | 会话管理（自动登录） | P0 |
| M01-07 | 多设备登录支持 | P2 |

**技术方案**: Supabase Auth（代码量约380行，传统开发需2000行以上）

---

#### M02: GPS 圈地系统

**功能描述**: 玩家通过实际行走绘制领地边界

**用户故事**:
- 作为玩家，我希望通过行走来圈定自己的领地
- 作为玩家，我希望能实时看到我的行走轨迹

**功能要求**:
| 需求ID | 需求描述 | 优先级 |
|--------|---------|--------|
| M02-01 | 实时 GPS 位置追踪 | P0 |
| M02-02 | 轨迹绘制与显示（蓝色线条） | P0 |
| M02-03 | 路径闭合检测（回到起点） | P0 |
| M02-04 | 多边形区域计算与验证 | P0 |
| M02-05 | 防作弊检测（速度异常、位置跳跃） | P0 |
| M02-06 | 领地重叠检测 | P0 |
| M02-07 | 圈地面积计算与显示 | P0 |
| M02-08 | 末日风格卫星地图显示 | P1 |

**技术方案**: Apple MapKit + CoreLocation（代码量约950行）

**验证规则**:
- 最小面积: 100 m²
- 最大面积: 100,000 m²（可通过订阅提升）
- 不可与他人领地重叠
- 移动速度上限: 30 km/h（防止车上作弊）

---

#### M03: 领地管理系统

**功能描述**: 管理已圈定的领地属性

**功能要求**:
| 需求ID | 需求描述 | 优先级 |
|--------|---------|--------|
| M03-01 | 领地命名 | P0 |
| M03-02 | 领地面积显示 | P0 |
| M03-03 | 领地内建筑数量统计 | P1 |
| M03-04 | 允许交易开关 | P1 |
| M03-05 | 领地活跃度检测（30天建设，90天活跃） | P2 |
| M03-06 | 领地回收机制 | P2 |

**技术方案**: Supabase Database + PostGIS

---

#### M04: POI 发现与搜刮系统

**功能描述**: 基于真实地点的资源探索机制

**功能要求**:
| 需求ID | 需求描述 | 优先级 |
|--------|---------|--------|
| M04-01 | 真实 POI 数据加载（餐厅、医院、超市等） | P0 |
| M04-02 | POI 接近检测（地理围栏） | P0 |
| M04-03 | 搜刮交互界面 | P0 |
| M04-04 | POI 类型与资源映射 | P0 |
| M04-05 | 搜刮冷却时间机制 | P1 |
| M04-06 | 探索成就统计（距离、时长） | P1 |

**POI 资源映射表**:
| POI 类型 | 产出资源 |
|---------|---------|
| 医院/药店 | 药品（急救包、抗生素） |
| 超市/餐厅 | 食物（罐头、饮用水） |
| 工厂/工地 | 金属材料 |
| 公园/林地 | 木材 |
| 银行/珠宝店 | 稀有材料 |

**技术方案**: Apple MapKit POI Search（代码量约1400行）

---

#### M05: 背包/资源管理系统

**功能描述**: 玩家物品存储与管理

**功能要求**:
| 需求ID | 需求描述 | 优先级 |
|--------|---------|--------|
| M05-01 | 背包容量系统（默认100格） | P0 |
| M05-02 | 物品分类展示 | P0 |
| M05-03 | 物品使用功能 | P0 |
| M05-04 | 物品丢弃功能 | P1 |
| M05-05 | 本地优先架构（离线可用） | P1 |
| M05-06 | 云端同步机制 | P1 |

**技术方案**: SwiftData (本地) + Supabase (云端)

---

#### M06: 建造系统

**功能描述**: 在领地内建造各类建筑

**功能要求**:
| 需求ID | 需求描述 | 优先级 |
|--------|---------|--------|
| M06-01 | 建筑模板浏览（15种建筑） | P0 |
| M06-02 | 建筑分类筛选（生存/储存/生产/能源） | P0 |
| M06-03 | 建造资源消耗检查 | P0 |
| M06-04 | 建筑位置选择（拖拽放置） | P1 |
| M06-05 | 建造进度显示 | P1 |
| M06-06 | 建筑升级功能 | P2 |

**建筑等级体系**:
- Tier 1: 生存基础（篝火、简易庇护所）
- Tier 2: 功能扩展（仓库、农田）
- Tier 3: 高级设施（太阳能板、风力发电机）

---

#### M07: 建筑状态管理

**功能描述**: 建筑生命周期状态管理

**建筑状态**:
- 建造中 (Constructing)
- 待激活 (Pending Activation)
- 运行中 (Active)
- 损坏 (Damaged)

**功能要求**:
| 需求ID | 需求描述 | 优先级 |
|--------|---------|--------|
| M07-01 | 状态机流转逻辑 | P0 |
| M07-02 | 激活操作 | P0 |
| M07-03 | 维修操作 | P1 |
| M07-04 | 升级限制（仅激活状态可升级） | P1 |

---

#### M08: 玩家交易系统

**功能描述**: 玩家之间的物物交换

**功能要求**:
| 需求ID | 需求描述 | 优先级 |
|--------|---------|--------|
| M08-01 | 发布交易挂单 | P0 |
| M08-02 | 浏览附近挂单（100米范围内） | P0 |
| M08-03 | 接受交易 | P0 |
| M08-04 | 取消挂单 | P0 |
| M08-05 | 交易历史记录 | P1 |

**交易规则**:
- 必须进入对方领地 100米范围内才能看到挂单
- 以物易物，无货币系统

---

#### M09: 消息中心

**功能描述**: 系统消息推送与展示

**功能要求**:
| 需求ID | 需求描述 | 优先级 |
|--------|---------|--------|
| M09-01 | 官方公告展示 | P0 |
| M09-02 | 生存指南推送 | P0 |
| M09-03 | 每日任务通知 | P1 |
| M09-04 | 消息已读/未读状态 | P1 |

---

#### M10: 公共频道聊天

**功能描述**: 基于位置的公共聊天室

**功能要求**:
| 需求ID | 需求描述 | 优先级 |
|--------|---------|--------|
| M10-01 | 3km 范围公共频道 | P0 |
| M10-02 | 实时消息发送/接收 | P0 |
| M10-03 | 消息列表展示 | P0 |
| M10-04 | 用户昵称显示 | P0 |

**技术方案**: Supabase Realtime

---

#### M11: 频道管理系统

**功能描述**: 类似群组的私人频道

**功能要求**:
| 需求ID | 需求描述 | 优先级 |
|--------|---------|--------|
| M11-01 | 创建频道 | P0 |
| M11-02 | 加入频道 | P0 |
| M11-03 | 退出频道 | P0 |
| M11-04 | 频道列表浏览（显示距离、在线人数） | P0 |
| M11-05 | 频道内聊天 | P0 |

---

#### M12: PTT 语音呼叫

**功能描述**: 对讲机式语音通讯

**功能要求**:
| 需求ID | 需求描述 | 优先级 |
|--------|---------|--------|
| M12-01 | 长按说话 (Push to Talk) | P0 |
| M12-02 | 语音消息发送 | P0 |
| M12-03 | 频率选择界面 | P1 |

---

#### M13: 通讯设备等级

**功能描述**: 设备升级解锁更多通讯能力

**设备等级**:
| 等级 | 设备名称 | 能力 |
|------|---------|------|
| Lv.1 | 收音机 | 只能接收 |
| Lv.2 | 对讲机 | 收发，3km范围 |
| Lv.3 | 营地电台 | 收发，10km范围 |
| Lv.4 | 卫星通讯 | 收发，全球范围 |

---

#### M14: 个人主页/档案

**功能描述**: 玩家个人信息展示

**功能要求**:
| 需求ID | 需求描述 | 优先级 |
|--------|---------|--------|
| M14-01 | 幸存者等级显示 | P0 |
| M14-02 | 存活天数统计 | P0 |
| M14-03 | 领地数量/总面积统计 | P0 |
| M14-04 | 头像/昵称设置 | P1 |

---

#### M15: 多语言支持

**功能描述**: 应用国际化

**支持语言**:
- 简体中文 (zh-Hans)
- 繁体中文 (zh-Hant)
- 英文 (en)

**功能要求**:
| 需求ID | 需求描述 | 优先级 |
|--------|---------|--------|
| M15-01 | 语言切换功能 | P0 |
| M15-02 | 全局文本本地化 | P0 |
| M15-03 | 切换后应用重启 | P0 |

---

#### M16: 付费订阅系统

**功能描述**: 应用内购买与订阅

**订阅方案**:
| 方案名称 | 价格 | 权益 |
|---------|------|------|
| 开拓者月卡 | $9.99/月 | 无限探索、范围扩大 |
| 领主通行证 | $19.99/月 | 所有特权 |

**一次性购买**:
| 商品名称 | 价格 |
|---------|------|
| 初级物资包 | $0.99 |
| 中级物资包 | $2.99 |
| 稀有资源包 | $9.99 |

**技术方案**: StoreKit 2

---

#### M17: 排行榜系统

**功能描述**: 玩家竞技排名

**排行榜类型**:
- 领地面积榜
- 探索废墟榜
- 建筑数量榜

**功能要求**:
| 需求ID | 需求描述 | 优先级 |
|--------|---------|--------|
| M17-01 | 榜单切换 | P0 |
| M17-02 | 排名展示（前100） | P0 |
| M17-03 | 自己排名定位 | P0 |
| M17-04 | 5分钟缓存刷新 | P1 |

**技术方案**: 数据库窗口函数 + 缓存机制

---

#### M18: 成就系统

**功能描述**: 玩家成就与奖励

**成就稀有度**:
- 普通 (Common)
- 稀有 (Rare)
- 史诗 (Epic)
- 传说 (Legendary)

**功能要求**:
| 需求ID | 需求描述 | 优先级 |
|--------|---------|--------|
| M18-01 | 成就列表展示 | P0 |
| M18-02 | 成就解锁检测（EventBus） | P0 |
| M18-03 | 完成度统计 | P0 |
| M18-04 | 金币奖励发放 | P1 |

**技术方案**: EventBus 发布-订阅模式

---

#### M19: 生存体征系统

**功能描述**: 玩家生存状态管理

**体征指标**:
| 指标 | 初始值 | 衰减速度 |
|------|--------|---------|
| 核心生命 | 100 | - |
| 饱食度 | 100% | -5%/小时 |
| 水分 | 100% | -10%/小时 |

**增益机制**: 饱食度/水分 > 80% 时获得效率增益

**功能要求**:
| 需求ID | 需求描述 | 优先级 |
|--------|---------|--------|
| M19-01 | 体征数值显示 | P0 |
| M19-02 | 时间衰减计算 | P0 |
| M19-03 | 食物/水消耗补充 | P0 |
| M19-04 | 增益/减益效果 | P1 |
| M19-05 | 死亡机制（生命归零） | P2 |

---

## 4. 非功能需求

### 4.1 性能需求
- GPS 定位精度: < 10米
- 地图加载时间: < 2秒
- 消息送达延迟: < 1秒
- 排行榜查询响应: < 500ms

### 4.2 安全需求
- OAuth 2.0 认证
- 数据传输 HTTPS 加密
- 防作弊机制（GPS欺骗检测）
- 敏感数据不存储在客户端

### 4.3 可用性需求
- 离线模式支持（背包查看、地图缓存）
- 弱网环境优化
- 支持 iOS 15.0+

### 4.4 可扩展性需求
- 支持 100,000 日活用户
- 数据库支持地理空间查询优化
- 消息系统支持水平扩展

---

## 5. 技术架构

### 5.1 技术栈
| 层级 | 技术选型 |
|------|---------|
| 前端 | SwiftUI + Swift |
| 地图 | Apple MapKit |
| 定位 | CoreLocation |
| 后端 | Supabase (PostgreSQL + PostGIS) |
| 认证 | Supabase Auth |
| 实时通讯 | Supabase Realtime |
| 支付 | StoreKit 2 |
| 本地存储 | SwiftData |

### 5.2 核心代码模块
| 功能模块 | 核心文件 |
|---------|---------|
| 登录注册 | AuthManager.swift |
| GPS圈地 | LocationManager.swift |
| 领地管理 | TerritoryManager.swift |
| POI发现 | POIManager.swift |
| 探索搜刮 | ExplorationManager.swift |
| 背包系统 | ItemManager.swift |
| 建造系统 | BuildingManager.swift |
| 交易系统 | TradeManager.swift |
| 消息中心 | RadioManager.swift |
| 实时聊天 | CommunicationManager.swift |
| 频道管理 | ChannelManager.swift |
| 内购支付 | StoreKitManager.swift |
| 排行榜 | LeaderboardManager.swift |
| 成就系统 | AchievementManager.swift |
| 生存体征 | VitalSignsManagerV2.swift |

---

## 6. 上线计划

### Phase 1: MVP (核心玩法)
- 用户登录注册
- GPS 圈地系统
- 领地管理
- POI 发现与搜刮
- 背包系统

### Phase 2: 建设与交易
- 建造系统
- 建筑状态管理
- 玩家交易系统

### Phase 3: 社交系统
- 消息中心
- 公共频道聊天
- 频道管理

### Phase 4: 商业化
- 付费订阅系统
- 排行榜系统
- 成就系统

### Phase 5: 体验优化
- 多语言支持
- PTT 语音呼叫
- 生存体征系统

---

## 7. 风险与依赖

### 7.1 技术风险
| 风险 | 影响 | 缓解措施 |
|------|------|---------|
| GPS精度不足 | 圈地体验差 | 使用融合定位算法 |
| 后端服务不可用 | 游戏无法运行 | 本地优先架构 + 缓存 |
| 苹果审核拒绝 | 上架延迟 | 提前了解审核指南 |

### 7.2 外部依赖
- Apple MapKit 服务可用性
- Supabase 服务稳定性
- App Store 审核流程

---

## 8. 附录

### 8.1 术语表
| 术语 | 定义 |
|------|------|
| LBS | Location-Based Service，基于位置的服务 |
| POI | Point of Interest，兴趣点 |
| PTT | Push to Talk，按下说话 |
| OAuth | 开放授权协议 |

### 8.2 参考文档
- [Apple MapKit 文档](https://developer.apple.com/documentation/mapkit)
- [Supabase 文档](https://supabase.com/docs)
- [StoreKit 2 文档](https://developer.apple.com/storekit/)

---

*文档结束*
